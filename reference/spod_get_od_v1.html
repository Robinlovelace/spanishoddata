<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Load the origin-destination v1 data (2020-2021) for specified dates — spod_get_od_v1 • spanishoddata</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Load the origin-destination v1 data (2020-2021) for specified dates — spod_get_od_v1"><meta name="description" content="This function retrieves the v1 (2020-2021) origin_destination_data for the specified dates. It checks if the requested data is already cached locally and downloads it if it is not. When all the requested data is cached, it creates a DuckDB connection to the cache data folder and provides an table"><meta property="og:description" content="This function retrieves the v1 (2020-2021) origin_destination_data for the specified dates. It checks if the requested data is already cached locally and downloads it if it is not. When all the requested data is cached, it creates a DuckDB connection to the cache data folder and provides an table"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spanishoddata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/work-with-v1-data.html">Working with v1 MITMA data</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Load the origin-destination v1 data (2020-2021) for specified dates</h1>

      <div class="d-none name"><code>spod_get_od_v1.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function retrieves the v1 (2020-2021) origin_destination_data for the specified dates. It checks if the requested data is already cached locally and downloads it if it is not. When all the requested data is cached, it creates a <code>DuckDB</code> connection to the cache data folder and provides an table</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spod_get_od_v1</span><span class="op">(</span></span>
<span>  zones <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"districts"</span>, <span class="st">"dist"</span>, <span class="st">"distr"</span>, <span class="st">"distritos"</span>, <span class="st">"municipalities"</span>, <span class="st">"muni"</span>,</span>
<span>    <span class="st">"municip"</span>, <span class="st">"municipios"</span><span class="op">)</span>,</span>
<span>  dates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="spod_get_data_dir.html">spod_get_data_dir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  duck_max_mem <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  duck_max_threads <span class="op">=</span> <span class="fu">parallelly</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-zones">zones<a class="anchor" aria-label="anchor" href="#arg-zones"></a></dt>
<dd><p>The zones for which to download the data. Can be <code>"districts"</code> (or <code>"dist"</code>, <code>"distr"</code>, or the original Spanish <code>"distritos"</code>) or <code>"municipalities"</code> (or <code>"muni"</code>, <code>"municip"</code>, or the original Spanish <code>"municipios"</code>). Additionaly, these can be <code>"large_urban_areas"</code> (or <code>"lau"</code>, or the original Spanish <code>"grandes_areas_urbanas"</code>, or <code>"gau"</code>) for v2 data.</p></dd>


<dt id="arg-dates">dates<a class="anchor" aria-label="anchor" href="#arg-dates"></a></dt>
<dd><p>A <code>character</code> or <code>Date</code> vector of dates to process. Kindly keep in mind that v1 and v2 data follow different data collection methodologies and may not be directly comparable. Therefore, do not try to request data from both versions for the same date range. If you need to compare data from both versions, please refer to the respective codebooks and methodology documents. The v1 data covers the period from 2020-02-14 to 2021-05-09, and the v2 data covers the period from 2022-01-01 to the present until further notice. The true dates range is checked against the available data for each version on every function run.</p>
<p>The possible values can be any of the following:</p><ul><li><p>A single date in ISO (YYYY-MM-DD) or YYYYMMDD format. <code>character</code> or <code>Date</code> object.</p></li>
<li><p>A vector of dates in ISO (YYYY-MM-DD) or YYYYMMDD format. <code>character</code> or <code>Date</code> object. Can be any non-consecutive sequence of dates.</p></li>
<li><p>A date range</p><ul><li><p>eigher a <code>character</code> or <code>Date</code> object of length 2 with clearly named elements <code>start</code> and <code>end</code> in ISO (YYYY-MM-DD) or YYYYMMDD format. E.g. <code>c(start = "2020-02-15", end = "2020-02-17")</code>;</p></li>
<li><p>or a <code>character</code> object of the form <code>YYYY-MM-DD_YYYY-MM-DD</code> or <code>YYYYMMDD_YYYYMMDD</code>. For example, <code>2020-02-15_2020-02-17</code> or <code>20200215_20200217</code>.</p></li>
</ul></li>
<li><p>A regular expression to match dates in the format <code>YYYYMMDD</code>. <code>character</code> object. For example, <code>^202002</code> will match all dates in February 2020.</p></li>
</ul></dd>


<dt id="arg-data-dir">data_dir<a class="anchor" aria-label="anchor" href="#arg-data-dir"></a></dt>
<dd><p>The directory where the data is stored. Defaults to the value returned by <code><a href="spod_get_data_dir.html">spod_get_data_dir()</a></code> which returns the value of the environment variable <code>SPANISH_OD_DATA_DIR</code> or a temporary directory if the variable is not set.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, the function does not print messages to the console. Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-duck-max-mem">duck_max_mem<a class="anchor" aria-label="anchor" href="#arg-duck-max-mem"></a></dt>
<dd><p>The maximum memory to use in GB. A conservative default is 3 GB, which should be enough for resaving the data to DuckDB form a folder of CSV.gz files while being small enough to fit in memory of most even old computers. For data analysis using the already converted data (in DuckDB or Parquet format) or with the raw CSV.gz data, it is recommended to increase it according to available resources.</p></dd>


<dt id="arg-duck-max-threads">duck_max_threads<a class="anchor" aria-label="anchor" href="#arg-duck-max-threads"></a></dt>
<dd><p>The maximum number of threads to use. Defaults to the number of available cores minus 1.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A DuckDB table connection object. It can be manupulated using <code>dplyr</code> verbs, or can be loaded into memory using <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::collect()</a></code>. The structure of the object is as follows:</p>
<dl><dt>full_date</dt>
<dd><p><code>Date</code>. The full date of the trip, including year, month, and day.</p></dd>

<dt>id_origin</dt>
<dd><p><code>factor</code>. The identifier for the origin location of the trip, formatted as a code (e.g., '01001_AM').</p></dd>

<dt>id_destination</dt>
<dd><p><code>factor</code>. The identifier for the destination location of the trip, formatted as a code (e.g., '01001_AM').</p></dd>

<dt>activity_origin</dt>
<dd><p><code>factor</code>. The type of activity at the origin location (e.g., 'home', 'work').</p></dd>

<dt>activity_destination</dt>
<dd><p><code>factor</code>. The type of activity at the destination location (e.g., 'home', 'other').</p></dd>

<dt>residence_province</dt>
<dd><p><code>factor</code>. The province of residence for the individual making the trip (e.g. 'Cuenca', 'Girona').</p></dd>

<dt>time_slot</dt>
<dd><p><code>integer</code>. The time slot during which the trip started, represented as an integer (e.g., 0, 1, 2).</p></dd>

<dt>distance</dt>
<dd><p><code>factor</code>. The distance category of the trip, represented as a code (e.g., '002-005' for 2-5 km).</p></dd>

<dt>n_trips</dt>
<dd><p><code>double</code>. The number of trips taken within the specified time slot and distance.</p></dd>

<dt>trips_total_length_km</dt>
<dd><p><code>double</code>. The total length of all trips in kilometers for the specified time slot and distance.</p></dd>

<dt>year</dt>
<dd><p><code>double</code>. The year of the trip.</p></dd>

<dt>month</dt>
<dd><p><code>double</code>. The month of the trip.</p></dd>

<dt>day</dt>
<dd><p><code>double</code>. The day of the trip.</p></dd>


</dl><p>This object also contains the reference to the source DuckDB conneciton with the full view of the cached data. It can be accessed using <code>od_table$src$con</code>. See examples below. The connection includes two views:</p><ul><li><p><code>od_csv_raw</code> - a raw table view of all cached CSV files with the origin-destination data that has been previously cached in $SPANISH_OD_DATA_DIR</p></li>
<li><p><code>od_csv_clean</code> - a cleaned-up table view of <code>od_csv_raw</code> with column names and values translated and mapped to English. This still includes all cached data.</p></li>
</ul><p>View <code>od_csv_clean</code> has the same structure as the filtered view 'od_filtered', which is returned by <code>spod_get_od_v1()</code> as a DuckDB table connection object. The view <code>od_csv_raw</code> has original Spanish column names and values and has the following structure:</p><dl><dt>fecha</dt>
<dd><p><code>Date</code>. The date of the trip, including year, month, and day.</p></dd>

<dt>origen</dt>
<dd><p><code>character</code>. The identifier for the origin location of the trip, formatted as a character string (e.g., '01001_AM').</p></dd>

<dt>destino</dt>
<dd><p><code>character</code>. The identifier for the destination location of the trip, formatted as a character string (e.g., '01001_AM').</p></dd>

<dt>actividad_origen</dt>
<dd><p><code>character</code>. The type of activity at the origin location (e.g., 'casa', 'trabajo').</p></dd>

<dt>actividad_destino</dt>
<dd><p><code>character</code>. The type of activity at the destination location (e.g., 'otros', 'trabajo').</p></dd>

<dt>residencia</dt>
<dd><p><code>character</code>. The code representing the residence of the individual making the trip (e.g., '01') according to the official INE classification.</p></dd>

<dt>edad</dt>
<dd><p><code>character</code>. The age of the individual making the trip. This data is actaully filled with 'NA' values, which is why this column is removed in the cleaned-up and translated view described above.</p></dd>

<dt>periodo</dt>
<dd><p><code>integer</code>. The time period during which the trip started, represented as an integer (e.g., 0, 1, 2).</p></dd>

<dt>distancia</dt>
<dd><p><code>character</code>. The distance category of the trip, represented as a character string (e.g., '002-005' for 2-5 km).</p></dd>

<dt>viajes</dt>
<dd><p><code>double</code>. The number of trips taken within the specified time period and distance.</p></dd>

<dt>viajes_km</dt>
<dd><p><code>double</code>. The total length of all trips in kilometers for the specified time period and distance.</p></dd>

<dt>day</dt>
<dd><p><code>double</code>. The day of the trip.</p></dd>

<dt>month</dt>
<dd><p><code>double</code>. The month of the trip.</p></dd>

<dt>year</dt>
<dd><p><code>double</code>. The year of the trip.</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create a connection to the v1 data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>SPANISH_OD_DATA_DIR <span class="op">=</span> <span class="st">"~/home/nosync/cache/mitma"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-02-14"</span>, <span class="st">"2020-03-14"</span>, <span class="st">"2021-02-14"</span>, <span class="st">"2021-02-14"</span>, <span class="st">"2021-02-15"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">od_dist</span> <span class="op">&lt;-</span> <span class="fu">spod_get_od_v1</span><span class="op">(</span>zones <span class="op">=</span> <span class="st">"distr"</span>, dates <span class="op">=</span> <span class="va">dates</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># od dist is a table view filtered to the specified dates</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># access the source connection with all dates</span></span></span>
<span class="r-in"><span><span class="co"># list tables</span></span></span>
<span class="r-in"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html" class="external-link">dbListTables</a></span><span class="op">(</span><span class="va">od_dist</span><span class="op">$</span><span class="va">src</span><span class="op">$</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Egor Kotov, Robin Lovelace.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

